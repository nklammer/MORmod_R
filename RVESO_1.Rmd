---
title: "Process ReadVarsESO csv"
author: "Noah Klammer"
date: "3/15/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Import

```{r import, message=FALSE, warning=FALSE}
eplusout <- readr::read_csv("eplusout.csv")
# View(eplusout)
```

```{r message=FALSE, warning=FALSE}
library(readr)
IdLoAiSy_Map <- read_csv("IdLoAiSy-Map.csv")

ILAS_map <- IdLoAiSy_Map %>%
  na.omit() %>%
  arrange(`Ideal Air Loads System Number`)

# View(ILAS_map)
```


```{r include=FALSE}
# readr::spec(eplusout)

freq <- "null"
rows <- nrow(eplusout) 
if (rows==8760*4) {
  freq <- "15 minutes"
} else if (rows==8760) {
  freq <- "hourly"
} else if (rows==12) {
  freq <- "monthly"
} else {freq <- "could not determine"}

```
There are ``r ncol(eplusout)`` column variables in this file with names like ``r names(eplusout)[3]``, ``r names(eplusout)[50]``, and ``r names(eplusout)[100]``.

The frequency of this .eso file's timestep is ``r freq``.


### Get all var names that match "Sensible" && "Zone Ideal Loads"
```{r}
ILAS_col <- grep('Sensible', value = TRUE,
  grep('Zone Ideal Loads', names(eplusout), value = TRUE) 
  )
# list
```

*Done*


### sort and fix "10" < "2"
```{r}
sorted_list <- stringr::str_sort(ILAS_col, numeric = TRUE)

ILAS <- eplusout[sorted_list]
```
*Done*

### replace Air System Number with Zone name

```{r}
library(stringr)
head(
stringr::str_replace(colnames(ILAS), 
                     "[0-9]+", 
                     rep(ILAS_map$`Zone List`, each = 2))
)
```
*Done*

```{r}
# try 2 take air system mapping and write for loop
mytest <- colnames(ILAS) # make clone for test variable
# control flow system boundary = all column names "...AIR SYSTEM X:Zone Ideal..."
# evaluate number of matches to `grepl` for `pattern_match` string

# start by declaring number of interest from system number set

# for (i in length( mytest )) {

# create iteration match_pattern from inside loop
match_pattern <- paste0("(^|[^0-9])",as.character(ILAS_map$`Ideal Air Loads System Number`[i]),"([^0-9]|$)")

# determine number of matches to set
sum(grepl(match_pattern,mytest))

# get subset with match of interest
mytest[grepl(match_pattern,mytest)]

  # string "ZONE HVAC IDEAL LOADS AIR SYSTEM 2:Zone Ideal ... (Hourly)"
      sub(
      # pattern "2" match single character exactly once (^|[^0-9])1([^0-9]|$)
      # take 2  1([^0-9]|$) 
      match_pattern,
      # replacement "STAIRWELL_2_4"
      paste0(" ",ILAS_map$`Zone List`[i],":"),
      # this has to be a match
      mytest[grepl(match_pattern,mytest)]
      )

  # }

mytest
# all that happened was the last value was set to NA

# colnames(ILAS)

# head(
# stringr::str_replace(colnames(ILAS),"2", ILAS_map$`Zone List`[2])
# )


```


### TODO - edit and save template reporting measure to extract exactly the variables I want

1) Date/Time
2) Zone HVAC Ideal Loads Air System XX: Zone Ideal Loads Zone Sensible XXXXXXX Energy \[J](Hourly)
3) Zone Area (see OpenStudio Results section Zone Summary)
4) Zone's surfaces' boundary condition (Number of exposed surfaces) (see Envelope and Internal Load Breakdown Report section Surface Average Face Conduction Heat Gain/Loss)
5) Total Site EUI (OpenStudio Results)
6) Weather File (OS Results)
7) North Axis Angle (OS Results)
8) ASHRAE/CEC Climate Zone (OS Results)

<br><br><br>