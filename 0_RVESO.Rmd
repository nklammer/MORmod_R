---
title: "Process ReadVarsESO csv"
author: "Noah Klammer"
date: "3/15/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## Clear global and report

```{r}
rm(list = ls())
gc()
```


# Import

```{r import, message=FALSE, warning=FALSE}
eplusout <- readr::read_csv("eplusout.csv")
# View(eplusout)
```

```{r message=FALSE, warning=FALSE}
library(readr)
IdLoAiSy_Map <- read_csv("IdLoAiSy-Map.csv")
unc_zones <- IdLoAiSy_Map$`Zone List`[is.na(IdLoAiSy_Map$`Ideal Air Loads System Number`)]

ILAS_map <- IdLoAiSy_Map %>%
  na.omit() %>%
  arrange(`Ideal Air Loads System Number`)

```
Unconditioned zones in this model are ``r unc_zones``


```{r include=FALSE}
# readr::spec(eplusout)

freq <- "null"
rows <- nrow(eplusout) 
if (rows==8760*4) {
  freq <- "15 minutes"
} else if (rows==8760) {
  freq <- "hourly"
} else if (rows==12) {
  freq <- "monthly"
} else {freq <- "could not determine"}

```
There are ``r ncol(eplusout)`` column variables in this file with names like ``r names(eplusout)[3]``, ``r names(eplusout)[50]``, and ``r names(eplusout)[100]``.

The frequency of this .eso file's timestep is ``r freq``.


### Get all var names that match "Sensible" && "Zone Ideal Loads"
```{r}
ILAS_col <- grep('Sensible', value = TRUE,
  grep('Zone Ideal Loads', names(eplusout), value = TRUE) 
  )
```

*Done* There are ``r length(ILAS_col)`` column variables in this subset.



### sort
```{r}

# sort and fix "10" < "2"
sorted_list <- stringr::str_sort(ILAS_col, numeric = TRUE)

ILAS <- eplusout[sorted_list]

```


### replace Air System Number with Zone name

```{r}
library(stringr)
colnames(ILAS) =
stringr::str_replace(colnames(ILAS), 
                     "[0-9]+", 
                     rep(ILAS_map$`Zone List`, each = 2))
```
*Done*

### Inspect Zones and select only residential zones of interest

```{r}
res_list <- 
c(
grep("STAIRWELL_\\d", colnames(ILAS), value = TRUE),
grep("CORRIDOR_\\d", colnames(ILAS), value = TRUE),  
grep("BDRM", colnames(ILAS), value = TRUE)
)

sorted_list <- stringr::str_sort(res_list, numeric = TRUE)

ILAS <- ILAS[sorted_list]
```


### add Date/Time back in
```{r}
`Date/Time` <- eplusout$`Date/Time`
ILAS <- cbind(`Date/Time`,ILAS)

#as.integer(
  substr(ILAS$`Date/Time`[2],2,15)
 # )

# separate the date and time into month, day, hour, minute
ILAS <- ILAS %>%
  mutate(month = as.integer(substr(`Date/Time`, start = 0, stop = 2)),
         day = as.integer(substr(`Date/Time`, start = 4, stop = 5)),
         hour = as.integer(substr(`Date/Time`, start = 8, stop = 9)),
         `Date/Time` = as.integer(substr(`Date/Time`, start = 11, stop = 12))) %>%
  rename(minute = `Date/Time`)

sorted_list <- stringr::str_sort(colnames(ILAS), numeric = TRUE)

ILAS <- ILAS[sorted_list]

# remove NA observations
ILAS <- ILAS %>% na.omit()
# remove the automatic column numbers
rownames(ILAS) <- NULL
```
*Done* The variables of interest have been selected and observations of NA have been removed. The dataframe now has ``r ncol(ILAS)`` columns and ``r nrow(ILAS)`` rows.

### TODO - pick out 4 days per Zahra's recommendation

### TODO - review clustering

### TODO - save as .Rda file

```{r}
save(ILAS,file = "ILAS.Rda")
```


### TODO - edit and save template OS reporting measure to extract exactly the variables I want

1) Date/Time
2) Zone HVAC Ideal Loads Air System XX: Zone Ideal Loads Zone Sensible XXXXXXX Energy [J]\(Hourly)
3) Zone Area (see OpenStudio Results section Zone Summary)
4) Zone's surfaces' boundary condition (Number of exposed surfaces) (see Envelope and Internal Load Breakdown Report section Surface Average Face Conduction Heat Gain/Loss)
5) Total Site EUI (OpenStudio Results)
6) Weather File (OS Results)
7) North Axis Angle (OS Results)
8) ASHRAE/CEC Climate Zone (OS Results)

<br><br><br>